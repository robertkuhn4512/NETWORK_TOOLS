## This file contains links to only the steps needed to bring up all the containers and services on a fresh install (This assumes your Host OS is all set). See the full readme file for longer explinations.


- [Full README](./README.full.md)
- [Ubuntu ARM Development Server – NETWORK_TOOLS Setup](./README.full.md#ubuntu-arm-development-server-network_tools-setup)
  - [Table of Contents](./README.full.md#table-of-contents)
    - [3.1 Generate TLS Certificates](./README.full.md#31-generate-tls-certificates)
    - [3.2 Validate Certificates](./README.full.md#32-validate-certificates)
      - [3.6.1 Run the Init + Unseal Script](./README.full.md#361-run-the-init-unseal-script)
      - [3.6.2 Bootstrap Artifacts (Download Then Remove)](./README.full.md#362-bootstrap-artifacts-download-then-remove)
    - [3.7 TLS Certificate Trust and Best Practices](./README.full.md#37-tls-certificate-trust-and-best-practices)
      - [3.7.1 Local Development (Self-Signed CA)](./README.full.md#371-local-development-self-signed-ca)
      - [3.7.2 Production Environments (Recommended)](./README.full.md#372-production-environments-recommended)
      - [3.7.3 Practical Guidance for This Repo](./README.full.md#373-practical-guidance-for-this-repo)
    - [3.8 Vault Unseal and KV Seeding Bootstrap Scripts](./README.full.md#38-vault-unseal-and-kv-seeding-bootstrap-scripts)
      - [3.8.1 Overview (Which Script to Use)](./README.full.md#381-overview-which-script-to-use)
      - [3.8.2 Unseal-Only Usage](./README.full.md#382-unseal-only-usage)
      - [3.8.3 Single-Mount Seeder (vault_unseal_kv_seed_bootstrap_rootless.sh)](./README.full.md#383-single-mount-seeder-vault_unseal_kv_seed_bootstrap_rootlesssh)
        - [Working example (recommended): create mount + seed secrets under a prefix (no double-prefix)](./README.full.md#working-example-recommended-create-mount-seed-secrets-under-a-prefix-no-double-prefix)
        - [Reseeding note (KV v2 CAS)](./README.full.md#reseeding-note-kv-v2-cas)
      - [3.8.4 Multi-Mount Seeder (vault_unseal_multi_kv_seed_bootstrap_rootless.sh)](./README.full.md#384-multi-mount-seeder-vault_unseal_multi_kv_seed_bootstrap_rootlesssh)
      - [3.8.5 Seed Input Formats](./README.full.md#385-seed-input-formats)
        - [A) Map format (recommended): “path -> data object”](./README.full.md#a-map-format-recommended-path-data-object)
        - [B) List format: supports per-secret CAS overrides (KV v2)](./README.full.md#b-list-format-supports-per-secret-cas-overrides-kv-v2)
        - [Supported generators](./README.full.md#supported-generators)
        - [Optional “ENV injection” values](./README.full.md#optional-env-injection-values)
        - [Prefix rule (avoid double-prefix)](./README.full.md#prefix-rule-avoid-double-prefix)
      - [3.8.6 Multi Spec JSON Schema](./README.full.md#386-multi-spec-json-schema)
        - [Preferred schema (per-mount secrets)](./README.full.md#preferred-schema-per-mount-secrets)
      - [3.8.7 Example Seed Files](./README.full.md#387-example-seed-files)
        - [Single-mount template example (map format) + `--secrets-prefix bootstrap`](./README.full.md#single-mount-template-example-map-format-secrets-prefix-bootstrap)
        - [Single-mount template example (list format) with per-secret CAS (KV v2)](./README.full.md#single-mount-template-example-list-format-with-per-secret-cas-kv-v2)
        - [Multi spec example (preferred: per-mount secrets)](./README.full.md#multi-spec-example-preferred-per-mount-secrets)
      - [3.8.8 Output, Artifact Storage, and Security Notes](./README.full.md#388-output-artifact-storage-and-security-notes)
      - [3.8.9 Troubleshooting](./README.full.md#389-troubleshooting)
      - [3.8.10 Spec Format Notes, Validation Checks, and Common Pitfalls (Updated)](./README.full.md#3810-spec-format-notes-validation-checks-and-common-pitfalls-updated)
      - [3.8.11 Updated Multi-Mount Spec Example (Preferred)](./README.full.md#3811-updated-multi-mount-spec-example-preferred)
      - [3.8.12 Legacy Spec Example (mounts + writes)](./README.full.md#3812-legacy-spec-example-mounts-writes)
      - [3.8.13 About `"generate": { ... }` Values](./README.full.md#3813-about-generate-values)
  - [4. postgres](./README.full.md#4-postgres)
    - [4.1 Bootstrap credentials (generate + seed)](./README.full.md#41-bootstrap-credentials-generate-seed)
    - [4.2 Retrieve credentials from Vault](./README.full.md#42-retrieve-credentials-from-vault)
    - [4.3 Use with Docker Compose](./README.full.md#43-use-with-docker-compose)
      - [4.3.1 Compose prerequisites](./README.full.md#431-compose-prerequisites)
      - [4.3.2 Initialize the Postgres certs volume](./README.full.md#432-initialize-the-postgres-certs-volume)
      - [4.3.3 Start postgres_primary](./README.full.md#433-start-postgres_primary)
      - [4.3.4 Verify and connect](./README.full.md#434-verify-and-connect)
      - [4.3.5 Troubleshooting](./README.full.md#435-troubleshooting)
    - [4.4 Startup credential options (choose one)](./README.full.md#44-startup-credential-options-choose-one)
    - [4.5 Apply Vault credentials to an existing Postgres cluster](./README.full.md#45-apply-vault-credentials-to-an-existing-postgres-cluster)
    - [4.6 Rotation runbook (static credentials)](./README.full.md#46-rotation-runbook-static-credentials)
  - [5. pgAdmin](./README.full.md#5-pgadmin)
    - [5.1 Bootstrap credentials (generate + seed)](./README.full.md#51-bootstrap-credentials-generate-seed)
    - [5.2 Retrieve credentials from Vault](./README.full.md#52-retrieve-credentials-from-vault)
    - [5.3 Use with Docker Compose](./README.full.md#53-use-with-docker-compose)
    - [5.4 Startup credential options (choose one)](./README.full.md#54-startup-credential-options-choose-one)
  - [6. Postgres and pgAdmin Vault Integration Bootstrapping](./README.full.md#6-postgres-and-pgadmin-vault-integration-bootstrapping)
    - [6.1 Overview and constraints](./README.full.md#61-overview-and-constraints)
    - [6.2 Option A – Keep env file (.env) as the runtime source of truth](./README.full.md#62-option-a-keep-env-file-env-as-the-runtime-source-of-truth)
      - [When to use this option](./README.full.md#when-to-use-this-option)
      - [Steps](./README.full.md#steps)
    - [6.3 Option B – Vault Agent sidecar renders file-based secrets at container start](./README.full.md#63-option-b-vault-agent-sidecar-renders-file-based-secrets-at-container-start)
      - [High-level flow](./README.full.md#high-level-flow)
    - [6.3.1 Create a least-privilege Vault policy](./README.full.md#631-create-a-least-privilege-vault-policy)
    - [6.3.2 Create an AppRole for the agent](./README.full.md#632-create-an-approle-for-the-agent)
    - [6.3.3 Export Role ID and Secret ID for the Vault Agent](./README.full.md#633-export-role-id-and-secret-id-for-the-vault-agent)
      - [6.3.3.1 Recommended: use the repo export script](./README.full.md#6331-recommended-use-the-repo-export-script)
      - [6.3.3.2 Manual commands (fully expanded; no script)](./README.full.md#6332-manual-commands-fully-expanded-no-script)
    - [6.3.4 Vault Agent config + templates](./README.full.md#634-vault-agent-config-templates)
    - [6.3.5 Docker Compose wiring (vault-agent + shared secrets volume)](./README.full.md#635-docker-compose-wiring-vault-agent-shared-secrets-volume)
    - [6.3.6 Bring-up and verification](./README.full.md#636-bring-up-and-verification)
      - [6.3.6.1 Current bring-up commands (Approach 2: single compose file)](./README.full.md#6361-current-bring-up-commands-approach-2-single-compose-file)
      - [6.3.6.2 Troubleshooting: common Vault Agent errors](./README.full.md#6362-troubleshooting-common-vault-agent-errors)
    - [6.3.7 Rotation and operational notes](./README.full.md#637-rotation-and-operational-notes)
    - [6.4 Option C – Advanced: Vault Database secrets engine (dynamic credentials)](./README.full.md#64-option-c-advanced-vault-database-secrets-engine-dynamic-credentials)
      - [6.4.1 What this enables (and what it is *not*)](./README.full.md#641-what-this-enables-and-what-it-is-not)
      - [6.4.2 Prerequisites](./README.full.md#642-prerequisites)
      - [6.4.3 Create a dedicated Postgres management role for Vault](./README.full.md#643-create-a-dedicated-postgres-management-role-for-vault)
      - [6.4.4 Enable and configure Vault’s PostgreSQL database connection](./README.full.md#644-enable-and-configure-vaults-postgresql-database-connection)
      - [6.4.5 Create a Vault role that defines how dynamic users are created](./README.full.md#645-create-a-vault-role-that-defines-how-dynamic-users-are-created)
      - [6.4.6 Fetch credentials and validate](./README.full.md#646-fetch-credentials-and-validate)
      - [6.4.7 Rotation (future-facing)](./README.full.md#647-rotation-future-facing)
  - [7. Keycloak Vault Integration Bootstrapping](./README.full.md#7-keycloak-vault-integration-bootstrapping)
    - [7.1 Vault KV paths and required keys](./README.full.md#71-vault-kv-paths-and-required-keys)
    - [7.2 Seeding Keycloak secrets into Vault](./README.full.md#72-seeding-keycloak-secrets-into-vault)
      - [7.2.1 TLS material (local certs → Vault KV)](./README.full.md#721-tls-material-local-certs-vault-kv)
    - [7.3 Vault Agent sidecar for Keycloak](./README.full.md#73-vault-agent-sidecar-for-keycloak)
      - [7.3.1 Create a least-privilege Vault policy](./README.full.md#731-create-a-least-privilege-vault-policy)
      - [7.3.2 Create an AppRole for the Keycloak agent](./README.full.md#732-create-an-approle-for-the-keycloak-agent)
      - [7.3.3 Host-side export script (role_id + secret_id)](./README.full.md#733-host-side-export-script-role_id-secret_id)
      - [7.3.4 Vault Agent config + template](./README.full.md#734-vault-agent-config-template)
      - [7.3.5 Docker Compose wiring](./README.full.md#735-docker-compose-wiring)
      - [7.3.6 Bring-up and verification](./README.full.md#736-bring-up-and-verification)
      - [7.3.7 Troubleshooting](./README.full.md#737-troubleshooting)
      - [7.3.8 Rotation and operational notes](./README.full.md#738-rotation-and-operational-notes)
    - [7.4 Keycloak hardening notes](./README.full.md#74-keycloak-hardening-notes)
  - [Appendix A – Certificate Management](./README.full.md#appendix-a-certificate-management)
    - [A.1 Vault TLS Certificates – What to Keep and Where](./README.full.md#a1-vault-tls-certificates-what-to-keep-and-where)
      - [1. Files That Must Be Treated as Secrets](./README.full.md#1-files-that-must-be-treated-as-secrets)
      - [2. Files That Can Be Safely Distributed](./README.full.md#2-files-that-can-be-safely-distributed)
      - [3. Recommended Project Layout and Git Hygiene](./README.full.md#3-recommended-project-layout-and-git-hygiene)
      - [4. Minimal “Must-Keep” List](./README.full.md#4-minimal-must-keep-list)
  - [A.2 Rootless Docker and Subordinate UID/GID Ranges (subuid/subgid)](./README.full.md#a2-rootless-docker-and-subordinate-uidgid-ranges-subuidsubgid)
  - [What are UID/GID ranges?](./README.full.md#what-are-uidgid-ranges)
  - [Why “at least 65,536”?](./README.full.md#why-at-least-65536)
  - [How to check your current ranges](./README.full.md#how-to-check-your-current-ranges)
  - [How to set the ranges (Ubuntu)](./README.full.md#how-to-set-the-ranges-ubuntu)
  - [Common symptoms when this is missing or wrong](./README.full.md#common-symptoms-when-this-is-missing-or-wrong)
  - [Appendix B – Container Hardening Recommendations (Vault / Vault Agent / Postgres / pgAdmin)](./README.full.md#appendix-b-container-hardening-recommendations-vault-vault-agent-postgres-pgadmin)
    - [B.1 Network and port exposure](./README.full.md#b1-network-and-port-exposure)
    - [B.2 Drop privileges, reduce Linux capabilities, and prevent privilege escalation](./README.full.md#b2-drop-privileges-reduce-linux-capabilities-and-prevent-privilege-escalation)
    - [B.3 Read-only root filesystem + tmpfs](./README.full.md#b3-read-only-root-filesystem-tmpfs)
    - [B.4 Tighten service dependencies to avoid accidental Vault restarts](./README.full.md#b4-tighten-service-dependencies-to-avoid-accidental-vault-restarts)
    - [B.5 Secrets hygiene](./README.full.md#b5-secrets-hygiene)
    - [B.6 Image pinning and update discipline](./README.full.md#b6-image-pinning-and-update-discipline)
    - [B.7 Vault-specific hardening (forward-looking)](./README.full.md#b7-vault-specific-hardening-forward-looking)
  - [8. Lessons learned and common issues](./README.full.md#8-lessons-learned-and-common-issues)
    - [8.1 Vault Agent sidecar gotchas](./README.full.md#81-vault-agent-sidecar-gotchas)
    - [8.2 Template and rendering pitfalls](./README.full.md#82-template-and-rendering-pitfalls)
    - [8.3 Container entrypoint and permissions pitfalls](./README.full.md#83-container-entrypoint-and-permissions-pitfalls)
    - [8.4 Postgres credential drift and how to fix it](./README.full.md#84-postgres-credential-drift-and-how-to-fix-it)
